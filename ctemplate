#!/bin/bash

if [[ -z $1 ]]; then
    echo "ctemplate: usage: ctemplate <command> [<args>]"
    exit 1
fi

if [[ $1 == "uninstall" ]]; then
    rm -f $install_path/ctemplate
    rm -rf $config_path
    exit 0
fi

if [[ $1 == "module" ]]; then

    if [[ -z $2 ]]; then
        echo "ctemplate: usage: ctemplate module [name]"
        exit 1
    fi

    if [[ -e ../.ctemplate ]]; then
        cd ..
    fi

    if [[ -e .ctemplate ]]; then
        touch include/$2.h
        touch include/$2.test.h
        touch src/$2.c
        touch test/$2.test.c
        exit 0

    else
        echo "ctemplate module: not a valid ctemplate directory"
    fi

    exit 0
fi

mkdir $1
cd $1
touch .ctemplate
mkdir src test build include
touch src/main.c
echo -e "int main(int argc, char **argv) {\n    return 0;\n}" > src/main.c
cp src/main.c test/main.test.c

if [ "$2" == "--static-lib" ]; then
    cp $config_path/Makefile-a Makefile

elif [ "$2" == "--dynamic-lib" ]; then
    cp $config_path/Makefile-so Makefile

else
    cp $config_path/Makefile-elf Makefile
    sed -i "s/executable_name/$1/g" Makefile
    sed -i "s/test_executable/$1.test/g" Makefile 
fi

git init
touch .gitignore
echo ".ctemplate" >> .gitignore
git add .
